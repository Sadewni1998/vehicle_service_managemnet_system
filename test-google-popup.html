<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google OAuth Popup Test</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <h1>Google OAuth Popup Test</h1>
    <button id="googleSignInBtn">Sign in with Google</button>
    <div id="result"></div>

    <script>
        const GOOGLE_CLIENT_ID = '584667634499-3l8mh29qabpqpcjpds7p0p6a5t3gv3bl.apps.googleusercontent.com';
        
        function onGoogleLoad() {
            console.log('Google OAuth loaded');
        }

        function signInWithGoogle() {
            console.log('Starting Google sign-in...');
            
            const client = google.accounts.oauth2.initTokenClient({
                client_id: GOOGLE_CLIENT_ID,
                scope: 'openid email profile',
                callback: async (response) => {
                    console.log('OAuth response:', response);
                    
                    if (response.access_token) {
                        try {
                            // Get user info
                            const userInfoResponse = await fetch(
                                `https://www.googleapis.com/oauth2/v2/userinfo?access_token=${response.access_token}`
                            );
                            const userInfo = await userInfoResponse.json();
                            
                            console.log('User info:', userInfo);
                            document.getElementById('result').innerHTML = `
                                <h3>Success!</h3>
                                <p>Name: ${userInfo.name}</p>
                                <p>Email: ${userInfo.email}</p>
                                <p>ID: ${userInfo.id}</p>
                            `;
                        } catch (error) {
                            console.error('Error getting user info:', error);
                            document.getElementById('result').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                        }
                    } else {
                        document.getElementById('result').innerHTML = '<p style="color: red;">No access token received</p>';
                    }
                }
            });

            // This should open the popup
            client.requestAccessToken();
        }

        // Wait for Google to load
        window.onload = function() {
            document.getElementById('googleSignInBtn').addEventListener('click', signInWithGoogle);
        };
    </script>
</body>
</html>
